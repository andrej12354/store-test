<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Store</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
    header { background:#222; color:#fff; padding:10px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:20px; }
    nav button { margin-left:5px; }
    #main { display:flex; }
    aside { width:200px; background:#eee; padding:10px; }
    main { flex:1; padding:10px; }
    .product { background:#fff; padding:10px; margin:10px; border-radius:6px; }
    .product img { max-width:100%; height:150px; object-fit:cover; display:block; }
    .cart-item { background:#fff; padding:10px; margin:5px 0; display:flex; justify-content:space-between; }
    input, button, textarea { margin:5px 0; padding:6px; }
    .btn { padding:6px 12px; background:#333; color:#fff; border:none; border-radius:4px; cursor:pointer; }
    .btn:hover { background:#555; }
  </style>
</head>
<body>
  <header>
    <h1>Store</h1>
    <nav id="nav"></nav>
  </header>
  <div id="main">
    <aside>
      <div id="auth"></div>
      <button onclick="showView('shop')">Shop</button>
      <button onclick="showView('cart')">Cart</button>
      <button onclick="showView('staff')">Staff Panel</button>
    </aside>
    <main id="view"></main>
  </div>

<script>
const STORAGE = {
  USERS: 'store_users',
  PRODUCTS: 'store_products',
  SESSION: 'store_session',
  CART: 'store_cart'
}

function read(k,fallback){ try{ return JSON.parse(localStorage.getItem(k))||fallback }catch{return fallback} }
function write(k,v){ localStorage.setItem(k, JSON.stringify(v)) }

if(!read(STORAGE.USERS,null)){
  write(STORAGE.USERS,[{username:'staff',password:'staff',role:'staff'}])
}
if(!read(STORAGE.PRODUCTS,null)) write(STORAGE.PRODUCTS,[])

let user = read(STORAGE.SESSION,null)
let products = read(STORAGE.PRODUCTS,[])
let cart = read(STORAGE.CART,[])
let currentView = 'shop'

function saveAll(){
  write(STORAGE.SESSION,user)
  write(STORAGE.PRODUCTS,products)
  write(STORAGE.CART,cart)
}

function showView(v){ currentView=v; render() }

function login(u,p){
  const users = read(STORAGE.USERS,[])
  const found = users.find(x=>x.username===u&&x.password===p)
  if(found){ user={username:found.username,role:found.role}; saveAll(); render() }
  else alert('Invalid login')
}

function signup(u,p){
  let users = read(STORAGE.USERS,[])
  if(users.find(x=>x.username===u)) return alert('Username taken')
  const nu={username:u,password:p,role:'customer'}; users.push(nu)
  write(STORAGE.USERS,users)
  user={username:u,role:'customer'}; saveAll(); render()
}

function logout(){ user=null; saveAll(); render() }

function addProduct(title,price,desc,img){
  products.push({id:Date.now(),title,price:parseFloat(price),description:desc,image:img})
  saveAll(); render()
}

function removeProduct(id){ products=products.filter(p=>p.id!==id); saveAll(); render() }

function addToCart(id){
  const ex = cart.find(c=>c.id===id)
  if(ex) ex.qty++
  else cart.push({id,qty:1})
  saveAll(); showView('cart')
}

function changeQty(id,qty){ if(qty<1) cart=cart.filter(c=>c.id!==id); else { const c=cart.find(x=>x.id===id); if(c) c.qty=qty }
  saveAll(); render() }

function checkout(){ alert('Simulated checkout complete!'); cart=[]; saveAll(); render() }

function render(){
  document.getElementById('auth').innerHTML = user ? `Hello ${user.username} (${user.role}) <button onclick="logout()">Logout</button>` :
    `<h3>Login</h3><input id='lu'><br><input id='lp' type='password'><br><button onclick="login(lu.value,lp.value)">Login</button>
     <h3>Signup</h3><input id='su'><br><input id='sp' type='password'><br><button onclick="signup(su.value,sp.value)">Signup</button>`

  let html=''
  if(currentView==='shop'){
    html='<h2>Products</h2>'
    products.forEach(p=>{
      html+=`<div class='product'><img src="${p.image||''}" alt><h3>${p.title}</h3><p>${p.description}</p><b>$${p.price}</b><br><button class='btn' onclick='addToCart(${p.id})'>Add to Cart</button>${user&&user.role==='staff'?` <button onclick='removeProduct(${p.id})'>Delete</button>`:''}</div>`
    })
  }
  else if(currentView==='cart'){
    html='<h2>Your Cart</h2>'
    cart.forEach(c=>{
      const p=products.find(x=>x.id===c.id); if(!p) return
      html+=`<div class='cart-item'><span>${p.title} ($${p.price})</span>
      <input type='number' value='${c.qty}' min='1' onchange='changeQty(${c.id},parseInt(this.value))'>
      <button onclick='changeQty(${c.id},0)'>Remove</button></div>`
    })
    if(cart.length) html+=`<button class='btn' onclick='checkout()'>Checkout</button>`
  }
  else if(currentView==='staff'){
    if(!user||user.role!=='staff') html='<p>Staff only</p>'
    else html=`<h2>Add Product</h2>
      <input id='pt' placeholder='Title'><br>
      <input id='pp' placeholder='Price' type='number'><br>
      <textarea id='pd' placeholder='Description'></textarea><br>
      <input type='file' id='pi'><br>
      <button class='btn' onclick='handleAddProduct()'>Add</button>`
  }
  document.getElementById('view').innerHTML=html
}

function handleAddProduct(){
  const t=document.getElementById('pt').value
  const p=document.getElementById('pp').value
  const d=document.getElementById('pd').value
  const f=document.getElementById('pi').files[0]
  if(f){
    const reader=new FileReader()
    reader.onload=e=>{ addProduct(t,p,d,e.target.result) }
    reader.readAsDataURL(f)
  } else addProduct(t,p,d,'')
}

render()
</script>
</body>
</html>
