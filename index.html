<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Store - Home</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f2f2f2; }
    header { background:#131921; color:white; padding:10px; display:flex; align-items:center; justify-content:space-between; }
    .logo { font-size:24px; font-weight:bold; color:#ff9900; cursor:pointer; }
    .search-bar { flex:1; margin:0 20px; }
    .search-bar input { width:100%; padding:8px; border-radius:5px; border:none; }
    .nav-buttons button { margin-left:10px; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; }
    .products { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:20px; padding:20px; }
    .product { border:1px solid #ddd; border-radius:8px; padding:15px; text-align:center; background:white; }
    .product img { max-width:100%; height:150px; object-fit:cover; margin-bottom:10px; }
    .product h3 { margin:10px 0; font-size:16px; }
    .product p { color:green; font-weight:bold; }
    .product button { background:#ff9900; border:none; padding:10px; border-radius:5px; cursor:pointer; }

    #cartSidebar { position:fixed; top:0; right:-400px; width:300px; height:100%; background:white; box-shadow:-2px 0 5px rgba(0,0,0,0.5); transition:right 0.3s; padding:20px; overflow-y:auto; z-index:2000; }
    #cartSidebar.active { right:0; }
    #cartSidebar h2 { margin-top:0; }
    #closeCart { background:red; color:white; padding:5px 10px; border:none; cursor:pointer; }

    #authModal { display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); background:#fff; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.3); z-index:3000; border-radius:8px; }
    #authModal input { display:block; width:100%; margin-bottom:10px; padding:8px; }
    #authModal button { margin-right:10px; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; background:#ff9900; }
  </style>
</head>
<body>
  <header>
    <div class="logo" onclick="renderProducts()">Store</div>
    <div class="search-bar"><input type="text" id="searchInput" placeholder="Search for products..." oninput="searchProducts()"></div>
    <div class="nav-buttons">
      <button onclick="toggleAuth()" id="authBtn">Login/Signup</button>
      <button onclick="toggleCart()">Cart (<span id="cartCount">0</span>)</button>
    </div>
  </header>

  <div class="products" id="productList"></div>

  <div id="cartSidebar">
    <button id="closeCart" onclick="toggleCart()">X</button>
    <h2>Your Cart</h2>
    <ul id="cartItems"></ul>
    <h3>Total: $<span id="cartTotal">0.00</span></h3>
    <button onclick="checkout()">Checkout</button>
  </div>

  <div id="authModal">
    <h3>Login or Signup</h3>
    <input id="loginUser" placeholder="Username">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="performLogin()">Login</button>
    <button onclick="performSignup()">Signup</button>
    <button onclick="toggleAuth()">Close</button>
  </div>

  <script>
    const STORAGE = { PRODUCTS:'store_products', CART:'store_cart', USERS:'store_users' };
    function read(k,f){try{return JSON.parse(localStorage.getItem(k))||f}catch{return f}};
    function write(k,v){localStorage.setItem(k,JSON.stringify(v));}

    if(!read(STORAGE.PRODUCTS, null)){
      write(STORAGE.PRODUCTS,[
        {id:1,title:'Running Shoes',price:59.99,description:'Lightweight running shoes for daily training.',image:'https://via.placeholder.com/300x200?text=Running+Shoes'},
        {id:2,title:'Winter Jacket',price:89.99,description:'Warm insulated jacket with water-resistant shell.',image:'https://via.placeholder.com/300x200?text=Winter+Jacket'},
        {id:3,title:'Casual T-Shirt',price:19.99,description:'100% cotton casual tee.',image:'https://via.placeholder.com/300x200?text=Casual+T-Shirt'},
        {id:4,title:'Blue Jeans',price:39.99,description:'Comfort fit blue denim jeans.',image:'https://via.placeholder.com/300x200?text=Blue+Jeans'}
      ]);
    }

    if(!read(STORAGE.USERS, null)) write(STORAGE.USERS, []);

    let products = read(STORAGE.PRODUCTS, []);
    let cart = read(STORAGE.CART, []);
    let users = read(STORAGE.USERS, []);
    let currentUser = null;

    function saveAll(){ write(STORAGE.CART, cart); write(STORAGE.USERS, users); }

    function renderProducts(filter=''){
      const list = document.getElementById('productList'); list.innerHTML='';
      products.filter(p=>p.title.toLowerCase().includes(filter.toLowerCase())).forEach(p=>{
        const div=document.createElement('div'); div.className='product';
        div.innerHTML=`<img src="${p.image||''}" alt="">
          <h3>${p.title}</h3>
          <p>${p.description}</p>
          <p style="color:#111;font-weight:bold">$${p.price.toFixed(2)}</p>
          <button onclick="viewProduct(${p.id})">View</button>
          <button onclick="addToCart(${p.id})">Add to Cart</button>`;
        list.appendChild(div);
      }); updateCartCount();
    }

    function viewProduct(id){ window.location.href='product.html?id='+id; }

    function addToCart(id){ const p=products.find(x=>x.id===id); if(!p)return;
      const ex=cart.find(c=>c.id===id); if(ex) ex.qty++; else cart.push({id,qty:1}); saveAll(); updateCart(); toggleCart(true);
    }

    function updateCart(){ const el=document.getElementById('cartItems'); el.innerHTML=''; let total=0;
      cart.forEach(item=>{ const p=products.find(x=>x.id===item.id); if(!p)return; const li=document.createElement('li');
        li.textContent=`${p.title} x ${item.qty} - $${(p.price*item.qty).toFixed(2)}`; el.appendChild(li); total+=p.price*item.qty; });
      document.getElementById('cartTotal').innerText=total.toFixed(2); updateCartCount();
    }

    function updateCartCount(){ document.getElementById('cartCount').innerText=cart.reduce((s,c)=>s+c.qty,0); }

    function toggleCart(force){ const c=document.getElementById('cartSidebar');
      if(force===true)c.classList.add('active'); else if(force===false)c.classList.remove('active'); else c.classList.toggle('active'); updateCart();
    }

    function searchProducts(){ const q=document.getElementById('searchInput').value; renderProducts(q); }
    function toggleAuth(){ const m=document.getElementById('authModal'); m.style.display=m.style.display==='none'?'block':'none'; }

    function performLogin(){ const u=document.getElementById('loginUser').value; const p=document.getElementById('loginPass').value;
      const found=users.find(x=>x.username===u&&x.password===p); if(found){ currentUser=u; toggleAuth(); alert('Logged in as '+u); } else alert('Invalid credentials');
    }

    function performSignup(){ const u=document.getElementById('loginUser').value; const p=document.getElementById('loginPass').value;
      if(!u||!p)return alert('Enter username & password'); if(users.find(x=>x.username===u))return alert('Username taken');
      users.push({username:u,password:p}); saveAll(); currentUser=u; toggleAuth(); alert('Account created & logged in');
    }

    function checkout(){ if(!currentUser){ alert('Please login first'); toggleAuth(); return; } saveAll(); window.location.href='checkout.html'; }

    renderProducts(); updateCart();
  </script>
</body>
</html>
